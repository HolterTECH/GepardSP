{% extends "main_base.html" %}

{% block title %}–ö–∞–ª–µ–Ω–¥–∞—Ä—å –∑–∞–¥–∞—á –∏ —Å–æ–±—ã—Ç–∏–π{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css">
<style>
    .calendar-container {
        background: white;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        margin: 20px;
    }
    
    .calendar-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid #e9ecef;
    }
    
    .calendar-actions {
        display: flex;
        gap: 10px;
    }
    
    .calendar-filters {
        display: flex;
        gap: 20px;
        margin-bottom: 20px;
        flex-wrap: wrap;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 8px;
    }
    
    .filter-group {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }
    
    .filter-group strong {
        margin-bottom: 5px;
        color: #2c3e50;
    }
    
    .filter-checkbox {
        display: flex;
        align-items: center;
        gap: 8px;
        cursor: pointer;
        padding: 4px 0;
    }
    
    .event-type-badge {
        display: inline-block;
        width: 12px;
        height: 12px;
        border-radius: 2px;
        margin-right: 5px;
    }
    
    .badge-project { background-color: #3498db; }
    .badge-personal { background-color: #6c757d; }
    .badge-milestone { background-color: #FFD700; border: 1px solid #e6c200; }
    .badge-custom { background-color: #9b59b6; }
    
    .custom-event {
        border-left: 3px solid #9b59b6 !important;
    }
    
    .milestone-event {
        border: 2px solid #FFD700 !important;
        background: linear-gradient(135deg, #FFD700, #FFED4E) !important;
        color: #856404 !important;
        font-weight: bold;
    }
    
    /* –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ô–ù–ï–† –ö–ê–õ–ï–ù–î–ê–†–Ø - –í–ê–ñ–ù–û! */
    #calendar {
        margin-top: 20px;
        background: white;
        border-radius: 8px;
        padding: 15px;
        min-height: 600px; /* –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ */
        border: 1px solid #e9ecef;
    }
    
    .fc {
        height: 100%;
    }
    
    .fc-view {
        min-height: 500px;
    }
    
    .fc-event {
        cursor: pointer;
        border: none;
        padding: 2px 5px;
        font-size: 12px;
        border-radius: 4px;
    }
    
    .fc-event-milestone {
        border-radius: 15px !important;
        font-weight: bold;
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è —Ñ–æ—Ä–º—ã —Å–æ–∑–¥–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏—è */
    .time-options {
        display: none;
        margin-top: 10px;
        padding: 10px;
        background: #f8f9fa;
        border-radius: 5px;
    }
    
    .time-fields {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        margin-top: 10px;
    }
    
    .duration-field {
        grid-column: 1 / -1;
    }
    
    .form-radio-group {
        display: flex;
        gap: 15px;
        margin: 10px 0;
    }
    
    .radio-option {
        display: flex;
        align-items: center;
        gap: 5px;
        cursor: pointer;
    }
    
    .event-preview {
        margin-top: 15px;
        padding: 10px;
        background: #e8f4fd;
        border-radius: 5px;
        border-left: 4px solid #3498db;
    }
    
    /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
    .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.5);
    }
    
    .modal-content {
        background-color: white;
        margin: 5% auto;
        padding: 20px;
        border-radius: 8px;
        width: 90%;
        max-width: 500px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        position: relative;
    }
    
    .close {
        position: absolute;
        top: 15px;
        right: 20px;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
        color: #aaa;
    }
    
    .close:hover {
        color: #000;
    }
    
    /* –ö–Ω–æ–ø–∫–∏ */
    .btn {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 10px 20px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        text-decoration: none;
        transition: all 0.3s ease;
        font-weight: 500;
    }
    
    .btn-primary {
        background: #3498db;
        color: white;
    }
    
    .btn-primary:hover {
        background: #2980b9;
    }
    
    .btn-secondary {
        background: #95a5a6;
        color: white;
    }
    
    .btn-secondary:hover {
        background: #7f8c8d;
    }
    
    .btn-danger {
        background: #e74c3c;
        color: white;
    }
    
    .btn-danger:hover {
        background: #c0392b;
    }
    
    /* –§–æ—Ä–º—ã */
    .form-group {
        margin-bottom: 20px;
    }
    
    .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: 600;
        color: #2c3e50;
    }
    
    .form-group input,
    .form-group textarea,
    .form-group select {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
        box-sizing: border-box;
    }
    
    .form-group input:focus,
    .form-group textarea:focus,
    .form-group select:focus {
        border-color: #3498db;
        outline: none;
        box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
    }
    
    .modal-actions {
        display: flex;
        gap: 10px;
        justify-content: flex-end;
        margin-top: 20px;
        padding-top: 20px;
        border-top: 1px solid #e9ecef;
    }
</style>
{% endblock %}

{% block content %}
<div class="calendar-container">
    <div class="calendar-header">
        <h1>üìÖ –ö–∞–ª–µ–Ω–¥–∞—Ä—å –∑–∞–¥–∞—á –∏ —Å–æ–±—ã—Ç–∏–π</h1>
        <div class="calendar-actions">
            <button id="createEventBtn" class="btn btn-primary">+ –°–æ–∑–¥–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ</button>
            <button id="todayBtn" class="btn btn-secondary">–°–µ–≥–æ–¥–Ω—è</button>
        </div>
    </div>
    
    <div class="calendar-filters">
        <div class="filter-group">
            <strong>–¢–∏–ø—ã —Å–æ–±—ã—Ç–∏–π:</strong>
            <label class="filter-checkbox">
                <input type="checkbox" id="filterProjectTasks" checked>
                <span class="event-type-badge badge-project"></span>
                –ü—Ä–æ–µ–∫—Ç–Ω—ã–µ –∑–∞–¥–∞—á–∏
            </label>
            <label class="filter-checkbox">
                <input type="checkbox" id="filterPersonalTasks" checked>
                <span class="event-type-badge badge-personal"></span>
                –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏
            </label>
            <label class="filter-checkbox">
                <input type="checkbox" id="filterMilestones" checked>
                <span class="event-type-badge badge-milestone"></span>
                –í–µ—Ö–∏ –ø—Ä–æ–µ–∫—Ç–∞
            </label>
            <label class="filter-checkbox">
                <input type="checkbox" id="filterCustomEvents" checked>
                <span class="event-type-badge badge-custom"></span>
                –ú–æ–∏ —Å–æ–±—ã—Ç–∏—è
            </label>
        </div>
        
        <div class="filter-group">
            <strong>–°—Ç–∞—Ç—É—Å—ã –∑–∞–¥–∞—á:</strong>
            <label class="filter-checkbox">
                <input type="checkbox" id="filterPlanned" checked>
                <span style="color: #3498db">‚óè</span>
                –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ
            </label>
            <label class="filter-checkbox">
                <input type="checkbox" id="filterInProgress" checked>
                <span style="color: #f39c12">‚óè</span>
                –í —Ä–∞–±–æ—Ç–µ
            </label>
            <label class="filter-checkbox">
                <input type="checkbox" id="filterCompleted" checked>
                <span style="color: #27ae60">‚óè</span>
                –ó–∞–≤–µ—Ä—à–µ–Ω–æ
            </label>
        </div>
        
        <div class="filter-group">
            <strong>–õ–µ–≥–µ–Ω–¥–∞:</strong>
            <div style="font-size: 12px; color: #666;">
                <div>‚≠ê - –í–µ—Ö–∞ –ø—Ä–æ–µ–∫—Ç–∞</div>
                <div>üìã - –ó–∞–¥–∞—á–∞ –ø—Ä–æ–µ–∫—Ç–∞</div>
                <div>‚úÖ - –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è –∑–∞–¥–∞—á–∞</div>
                <div>üìÖ - –ú–æ–µ —Å–æ–±—ã—Ç–∏–µ</div>
            </div>
        </div>
    </div>
    
    <!-- –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ô–ù–ï–† –ö–ê–õ–ï–ù–î–ê–†–Ø -->
    <div id="calendar"></div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏—è -->
<div id="createEventModal" class="modal">
    <div class="modal-content" style="max-width: 600px;">
        <span class="close" onclick="closeCreateModal()">&times;</span>
        <h3>üìÖ –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ</h3>
        
        <form id="createEventForm">
            <div class="form-group">
                <label for="eventTitle">–ù–∞–∑–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è *</label>
                <input type="text" id="eventTitle" name="title" required 
                       placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è">
            </div>
            
            <div class="form-group">
                <label for="eventDescription">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                <textarea id="eventDescription" name="description" 
                         placeholder="–î–æ–±–∞–≤—å—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)"
                         rows="3"></textarea>
            </div>
            
            <div class="form-group">
                <label for="eventStartDate">–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ *</label>
                <input type="date" id="eventStartDate" name="start_date" required>
            </div>
            
            <div class="form-group">
                <label>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤—Ä–µ–º–µ–Ω–∏</label>
                <div class="form-radio-group">
                    <label class="radio-option">
                        <input type="radio" name="time_option" value="all_day" checked>
                        üìÖ –í–µ—Å—å –¥–µ–Ω—å
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="time_option" value="no_time">
                        ‚è≥ –ë–µ–∑ –≤—Ä–µ–º–µ–Ω–∏
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="time_option" value="with_time">
                        ‚è∞ –° –≤—Ä–µ–º–µ–Ω–µ–º
                    </label>
                </div>
                
                <div id="timeOptions" class="time-options">
                    <div class="time-fields">
                        <div>
                            <label for="eventStartTime">–í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞</label>
                            <input type="time" id="eventStartTime" name="start_time">
                        </div>
                        <div class="duration-field">
                            <label for="eventDuration">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–º–∏–Ω—É—Ç—ã)</label>
                            <select id="eventDuration" name="duration_minutes">
                                <option value="15">15 –º–∏–Ω—É—Ç</option>
                                <option value="30">30 –º–∏–Ω—É—Ç</option>
                                <option value="60" selected>1 —á–∞—Å</option>
                                <option value="90">1.5 —á–∞—Å–∞</option>
                                <option value="120">2 —á–∞—Å–∞</option>
                                <option value="180">3 —á–∞—Å–∞</option>
                                <option value="240">4 —á–∞—Å–∞</option>
                                <option value="custom">–î—Ä—É–≥–æ–µ...</option>
                            </select>
                            <div id="customDuration" style="display: none; margin-top: 5px;">
                                <input type="number" id="eventCustomDuration" 
                                      placeholder="–í–≤–µ–¥–∏—Ç–µ –º–∏–Ω—É—Ç—ã" min="1" max="1440">
                            </div>
                        </div>
                    </div>
                    <div class="event-preview" id="timePreview">
                        <strong>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä:</strong>
                        <div id="previewText">–°–æ–±—ã—Ç–∏–µ –Ω–∞ –≤–µ—Å—å –¥–µ–Ω—å</div>
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label for="eventColor">–¶–≤–µ—Ç —Å–æ–±—ã—Ç–∏—è</label>
                <select id="eventColor" name="color">
                    <option value="#3498db" style="color: #3498db;">üîµ –°–∏–Ω–∏–π</option>
                    <option value="#e74c3c" style="color: #e74c3c;">üî¥ –ö—Ä–∞—Å–Ω—ã–π</option>
                    <option value="#2ecc71" style="color: #2ecc71;">üü¢ –ó–µ–ª–µ–Ω—ã–π</option>
                    <option value="#f39c12" style="color: #f39c12;">üü† –û—Ä–∞–Ω–∂–µ–≤—ã–π</option>
                    <option value="#9b59b6" style="color: #9b59b6;">üü£ –§–∏–æ–ª–µ—Ç–æ–≤—ã–π</option>
                    <option value="#1abc9c" style="color: #1abc9c;">üîµ –ë–∏—Ä—é–∑–æ–≤—ã–π</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="eventType">–¢–∏–ø —Å–æ–±—ã—Ç–∏—è</label>
                <select id="eventType" name="event_type">
                    <option value="custom">üìÖ –û–±—ã—á–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ</option>
                    <option value="meeting">üë• –í—Å—Ç—Ä–µ—á–∞</option>
                    <option value="reminder">üîî –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ</option>
                    <option value="deadline">‚è∞ –î–µ–¥–ª–∞–π–Ω</option>
                    <option value="personal">üë§ –õ–∏—á–Ω–æ–µ</option>
                </select>
            </div>
            
            <div class="modal-actions">
                <button type="submit" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ</button>
                <button type="button" class="btn btn-secondary" onclick="closeCreateModal()">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </form>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Å–æ–±—ã—Ç–∏–∏ -->
<div id="eventModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <h3 id="modalEventTitle"></h3>
        <div class="event-details">
            <p><strong>–¢–∏–ø:</strong> <span id="modalEventType"></span></p>
            <p><strong>–ü—Ä–æ–µ–∫—Ç:</strong> <span id="modalProjectName"></span></p>
            <p id="modalStatusRow" style="display: none;"><strong>–°—Ç–∞—Ç—É—Å:</strong> <span id="modalEventStatus"></span></p>
            <p><strong>–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è:</strong> <span id="modalEventDates"></span></p>
            <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> <span id="modalEventDescription"></span></p>
        </div>
        <div class="modal-actions">
            <button id="goToEventBtn" class="btn btn-primary">–ü–µ—Ä–µ–π—Ç–∏</button>
            <button id="editEventBtn" class="btn btn-secondary" style="display: none;">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
            <button id="deleteEventBtn" class="btn btn-danger" style="display: none;">–£–¥–∞–ª–∏—Ç—å</button>
            <button class="btn btn-secondary" onclick="closeModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/locales/ru.js"></script>
<script src="{{ url_for('static', filename='js/calendar.js') }}"></script>
{% endblock %}
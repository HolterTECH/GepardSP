{% extends "main_base.html" %}

{% block title %}–ö–æ–º–∞–Ω–¥—ã - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞–º–∏{% endblock %}

{% block content %}
<div class="teams-container">
    <div class="team-header">
        <h1>üë• –ú–æ–∏ –∫–æ–º–∞–Ω–¥—ã</h1>
        <p>–ü—Ä–æ–µ–∫—Ç—ã, –≤ –∫–æ—Ç–æ—Ä—ã—Ö –≤—ã —É—á–∞—Å—Ç–≤—É–µ—Ç–µ, –∏ –∏—Ö –∫–æ–º–∞–Ω–¥—ã</p>
    </div>

    {% if projects_with_teams %}
        <div class="projects-grid">
            {% for project_data in projects_with_teams %}
            <div class="project-team-card">
                <div class="project-header">
                    <div class="project-title">{{ project_data.project.name }}</div>
                    <div class="members-count">{{ project_data.members|length }} —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</div>
                </div>
                
                <div class="members-list">
                    {% for member in project_data.members %}
                    <div class="member-item">
                        <div class="member-info">
                            <span class="member-name">{{ member.username }}</span>
                            <span class="member-email" style="font-size: 0.9em; color: #7f8c8d; display: block;">
                                {{ member.email }}
                            </span>
                        </div>
                        <div class="member-role-badge role-{{ member.role }}">
                            {{ member.role }}
                            {% if member.user_id == project_data.project.user_id %}
                            (–í–ª–∞–¥–µ–ª–µ—Ü)
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
                
                <div class="project-actions">
                    <a href="{{ url_for('project_team', project_id=project_data.project.id) }}" 
                       class="btn btn-primary">
                        <span>üë•</span>
                        –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥–æ–π
                    </a>
                    <a href="{{ url_for('kanban', project_id=project_data.project.id) }}" 
                       class="btn btn-secondary">
                        <span>üìã</span>
                        –ü–µ—Ä–µ–π—Ç–∏ –∫ –ø—Ä–æ–µ–∫—Ç—É
                    </a>
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="empty-state">
            <h3>–í—ã –ø–æ–∫–∞ –Ω–µ —É—á–∞—Å—Ç–≤—É–µ—Ç–µ –Ω–∏ –≤ –∫–∞–∫–∏—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö</h3>
            <p>–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç –∏–ª–∏ –ø–æ–ø—Ä–æ—Å–∏—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –≤–∞—Å –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π</p>
            <div style="margin-top: 20px;">
                <a href="{{ url_for('create_project') }}" class="btn btn-primary">
                    <span>‚ûï</span>
                    –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç
                </a>
                <a href="{{ url_for('index') }}" class="btn btn-secondary">
                    <span>üìÇ</span>
                    –ú–æ–∏ –ø—Ä–æ–µ–∫—Ç—ã
                </a>
            </div>
        </div>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
<script>
    // –î–æ–±–∞–≤–ª—è–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫
    document.addEventListener('DOMContentLoaded', function() {
        const cards = document.querySelectorAll('.project-team-card');
        cards.forEach((card, index) => {
            card.style.animationDelay = `${index * 0.1}s`;
        });
    });

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ –ø—Ä–æ–µ–∫—Ç–∞–º (–µ—Å–ª–∏ –ø—Ä–æ–µ–∫—Ç–æ–≤ –º–Ω–æ–≥–æ)
    document.addEventListener('DOMContentLoaded', function() {
        const projectCards = document.querySelectorAll('.project-team-card');
        
        // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–∏—Å–∫ –µ—Å–ª–∏ –ø—Ä–æ–µ–∫—Ç–æ–≤ –±–æ–ª—å—à–µ 5
        if (projectCards.length > 5) {
            const searchContainer = document.createElement('div');
            searchContainer.className = 'search-container';
            searchContainer.innerHTML = `
                <div class="form-group" style="max-width: 400px; margin: 20px 0;">
                    <input type="text" id="projectSearch" placeholder="–ü–æ–∏—Å–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤..." 
                           style="width: 100%; padding: 10px; border: 2px solid #e9ecef; border-radius: 8px;">
                </div>
            `;
            
            const teamHeader = document.querySelector('.team-header');
            teamHeader.parentNode.insertBefore(searchContainer, teamHeader.nextSibling);
            
            const searchInput = document.getElementById('projectSearch');
            
            searchInput.addEventListener('input', function(e) {
                const searchTerm = e.target.value.toLowerCase();
                
                projectCards.forEach(card => {
                    const projectName = card.querySelector('.project-title').textContent.toLowerCase();
                    const matches = projectName.includes(searchTerm);
                    
                    card.style.display = matches ? 'block' : 'none';
                    
                    // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è/—Å–∫—Ä—ã—Ç–∏—è
                    if (matches) {
                        card.style.animation = 'fadeInUp 0.3s ease-out';
                    }
                });
            });
        }
    });
</script>
{% endblock %}